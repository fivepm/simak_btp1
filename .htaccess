# 1. Mencegah Directory Listing (Wajib)

# Jika tidak ada file index.php di sebuah folder, server TIDAK akan menampilkan daftar file.

Options -Indexes

# 2. Blokir Akses ke File Tersembunyi (Diawali tanda titik)

# Ini melindungi .git, .env, .htaccess, .DS_Store, dll.

<FilesMatch "^\.">
Require all denied
</FilesMatch>

# 3. Blokir Akses ke File Konfigurasi & Dependency

# Karena Anda pakai Composer & Phinx, file ini TIDAK BOLEH diakses publik.

<FilesMatch "^(composer\.json|composer\.lock|package\.json|phinx\.php|phinx\.yml|phinx\.yaml)$">
Require all denied
</FilesMatch>

# 4. Blokir Akses ke File Log dan Backup Database

# Mencegah orang mendownload file error log atau backup SQL yang lupa dihapus.

<FilesMatch "\.(log|sql|bak|old|dist)$">
Require all denied
</FilesMatch>

# 5. (Opsional) Paksa HTTPS

# Jika website sudah online dan punya SSL, aktifkan baris di bawah ini agar selalu redirect ke HTTPS.

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

<IfModule mod_rewrite.c>
    RewriteEngine On

    # Aturan 1: Jika permintaan adalah untuk file atau direktori yang sudah ada,
    # jangan lakukan apa-apa. (Ini melindungi API login dan folder lain).
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 2. Alihkan semua permintaan lain ke index.php
    #RewriteRule ^(.*)$ index.php?page=$1 [L,QSA]

    # Aturan 2: Untuk permintaan lainnya, coba tambahkan ekstensi .php.
    # Aturan ini sekarang bisa menangani subfolder seperti 'auth/logout'.
    RewriteRule ^(.+)$ $1.php [NC,L]

</IfModule>
